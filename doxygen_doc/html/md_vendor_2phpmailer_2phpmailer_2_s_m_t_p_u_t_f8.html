<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>N.I.C.O.L.E: A short history of UTF-8 in email</title>
<link rel="icon" href="logo4-48.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo4-48.png"/></td>
  <td id="projectalign">
   <div id="projectname">N.I.C.O.L.E<span id="projectnumber">&#160;20251008</span>
   </div>
   <div id="projectbrief">Sistema de mensajerÃ­a y recetas saludables con IA</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Buscar',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_vendor_2phpmailer_2phpmailer_2_s_m_t_p_u_t_f8.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Cargando...</div>
<div class="SRStatus" id="Searching">Buscando...</div>
<div class="SRStatus" id="NoMatches">Nada coincide</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">A short history of UTF-8 in email </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md162"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md163"></a>
Background</h1>
<p>For most of its existence, SMTP has been a 7-bit channel, only supporting US-ASCII characters. This has been a problem for many languages, especially those that use non-Latin scripts, and has led to the development of various workarounds.</p>
<p>The first major improvement, introduced in 1994 in <a href="https://www.rfc-editor.org/rfc/rfc1652">RFC 1652</a> and extended in 2011 in <a href="https://www.rfc-editor.org/rfc/rfc6152">RFC 6152</a>, was the addition of the <span class="tt">8BITMIME</span> SMTP extension, which allowed raw 8-bit data to be included in message bodies sent over SMTP. This allowed the message <em>contents</em> to contain 8-bit data, including things like UTF-8 text, even though the SMTP protocol itself was still firmly 7-bit. This worked by having the server switch to 8-bit after the headers, and then back to 7-bit after the completion of a <span class="tt">DATA</span> command.</p>
<p>From 1996, messages could support <a href="https://www.rfc-editor.org/rfc/rfc2047">RFC 2047 encoding</a>, which permitted inserting characters from any character set into header <em>values</em> (but not names), but only by encoding them in somewhat unreadable ways to allow them to survive passage through a 7-bit channel. An example with a subject of "SchrÃ¶dinger's cat" would be:</p>
<div class="fragment"><div class="line">Subject: =?utf-8?Q=Schr=C3=B6dinger=92s_Cat?=</div>
</div><!-- fragment --><p>Here the accented <span class="tt">Ã¶</span> is encoded as <span class="tt">=C3=B6</span>, which is the UTF-8 encoding of the 2-byte character, and the whole thing is wrapped in <span class="tt">=?utf-8?Q?</span> to indicate that it uses the UTF-8 charset and <span class="tt">quoted-printable</span> encoding. This is a bit of a hack, and not very human-friendly, but it works.</p>
<p>Similarly, 8-bit message bodies could be encoded using the same <span class="tt">quoted-printable</span> and <span class="tt">base64</span> content transfer encoding (CTE) schemes, which preserved the 8-bit content while encoding it in a format that could survive transmission through a 7-bit channel.</p>
<p>Domain names were originally also stuck in a 7-bit world, actually even more constrained to only a subset of the US-ASCII character set. But of course, many people want to have domains in their own language/script. Internationalized domain name (IDN) permitted this, using yet another complex encoding scheme called punycode, defined for domain names in 2003 in <a href="https://www.rfc-editor.org/rfc/rfc3492">RFC 3492</a>. This finally allowed the domain part (after the <span class="tt">@</span>) of email addresses to contain UTF-8, though it was actually an illusion preserved by email client applications. For example, an address of <span class="tt">user@cafÃ©.example.com</span> translates to <span class="tt">user@xn--caf-dma.example.com</span> in punycode, rendering it mostly unreadable, but 7-bit friendly, and remaining compatible with email clients that don't know about IDN.</p>
<p>The one remaining part of email that could not handle UTF-8 is the local part of email addresses (the part before the <span class="tt">@</span>).</p>
<p>I've only mentioned UTF-8 here, but most of these approaches also allowed other character sets that were popular, such as <a href="https://en.wikipedia.org/wiki/ISO/IEC_8859">the ISO-8859 family</a>. However, UTF-8 solves so many problems that these other character sets are gradually falling out of favour, as UTF-8 can support all languages.</p>
<p>This patchwork of overlapping approaches has served us well, but we have to admit that it's a mess.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md164"></a>
SMTPUTF8</h1>
<p><span class="tt">SMTPUTF8</span> is another SMTP extension, defined in <a href="https://www.rfc-editor.org/rfc/rfc6531">RFC 6531</a> in 2012. This essentially solves the whole problem, allowing the entire SMTP conversation â€” commands, headers, and message bodies â€” to be sent in raw, unencoded UTF-8.</p>
<p>But there's a problem with this approach: adoption. If you send a UTF-8 message to a recipient whose mail server doesn't support this format, the sender has to somehow downgrade the message to make it survive a transition to 7-bit. This is a hard problem to solve, especially since there is no way to make a 7-bit system support UTF-8 in the local parts of addresses. This downgrade problem is what held up the adoption of <span class="tt">SMTPUTF8</span> in <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> for many years, but in that time the <em>de facto</em> approach has become to simply fail in that situation, and tell the recipient it's time they upgraded their mail server ðŸ˜….</p>
<p>The vast majority of large email providers (gmail, Yahoo, Microsoft, etc), mail servers (postfix, exim, IIS, etc), and mail clients (Apple Mail, Outlook, Thunderbird, etc) now all support SMTPUTF8, so the need for backward compatibility is no longer what it was.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md165"></a>
SMTPUTF8 in PHPMailer</h1>
<p>Several other PHP email libraries have implemented a halfway solution to <span class="tt">SMTPUTF8</span>, adding only the ability to support UTF-8 in email addresses, not elsewhere in the protocol. I wanted <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> to do it "the right way", and this has taken much longer. <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> now supports UTF-8 everywhere, and does not need to use transfer or header encodings for UTF-8 text when connecting to an <span class="tt">SMTPUTF8</span>-capable mail server.</p>
<p>This support is handled automatically: if you add an email address that requires UTF-8, <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> will use UTF-8 for everything. If not, it will fall back to 7-bit and encode the message as necessary.</p>
<p>The one place you will need to be careful is in the selection of the address validator. By default, <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> uses PHP's built-in <span class="tt">filter_var</span> validator, which does not allow UTF-8 email addresses. When <a class="el" href="namespace_p_h_p_mailer.html">PHPMailer</a> spots that you have submitted a UTF-8 address, but have not altered the default validator, it will automatically switch to using a UTF-8-compatible validator. As soon as you do this, any SMTP connection you make will <em>require</em> that the server you connect to supports <span class="tt">SMTPUTF8</span>. You can select this validator explicitly by setting &lsquo;PHPMailer::$validator = 'eai&rsquo;` (an acronym for Email Address Internationalization).</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md166"></a>
Postfix gotcha</h2>
<p>Postfix has supported <span class="tt">SMTPUTF8</span> for a long time, but it has a peculiarity that it does not always advertise that it does so. However, rather surprisingly, if you use UTF-8 in the conversation, it will work anyway. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generado por <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
